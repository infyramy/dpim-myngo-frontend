import{c as D,r as x,a as $,b as ee,W as L,o as se,e as N,i as I,j as ae,u as s,f as n,w as r,g as t,h as d,aW as te,bG as le,t as w,F as oe,k as re,p as ue,l as h}from"./vendor-D6Gd-AmM.js";import{u as ne}from"./user-C1Ds_kuC.js";import{a as E}from"./admin-DxRhEtpx.js";import{b as de,z as ie,_ as B,a as me,Q as _e,R as fe,S as ce,k as f,p as v,l as W,m as z,n as G,o as R,s as j,u as pe,c as ve,e as be}from"./ui-C-FEV6Jq.js";import"./deps-CXbEQKqm.js";import"./auth-DV8b8DmP.js";const P=x(null),p=x(!1),V=x(null);function ye(){const{error:A,success:l}=ne(),k=D(()=>p.value),S=D(()=>!!V.value),T=()=>{const m=localStorage.getItem("user");return m?JSON.parse(m).access_token:null},_=async()=>{try{p.value=!0,V.value=null;const m=await E().get("/profile",!0);P.value=m.data,console.log(m.data)}catch(m){$.error(m.data.message)}finally{p.value=!1}},b=async m=>{try{p.value=!0,V.value=null;const i=await E().put("/profile",m,!0);return console.log("updateData:",m),P.value=i.data,$.success(i.message),!0}catch(i){return $.error(i.data.message),!1}finally{p.value=!1}},y=async m=>{try{p.value=!0,V.value=null;const i=await E().put("/profile/notifications",m,!0);return $.success(i.message),!0}catch(i){return $.error(i.data.message),!1}finally{p.value=!1}},a=async m=>{try{p.value=!0,V.value=null;const i=new FormData;i.append("avatar",m);const g=T();if(!g)throw new Error("No access token found");const c=await fetch("/api/profile/avatar",{method:"POST",headers:{Authorization:`Bearer ${g}`},body:i});if(!c.ok){const M=await c.json().catch(()=>({}));throw new Error(M.message||`HTTP error! status: ${c.status}`)}const C=await c.json();return l("Success",{description:C.message||"Avatar uploaded successfully"}),!0}catch(i){const g=i instanceof Error?i.message:"Failed to upload avatar";return V.value=g,console.error("Error uploading avatar:",i),A("Error",{description:g}),!1}finally{p.value=!1}},U=()=>{P.value=null,V.value=null,p.value=!1};return{profile:D(()=>P.value),isLoading:k,hasError:S,error:D(()=>V.value),fetchProfile:_,updateProfile:b,updateNotificationPreferences:y,uploadAvatar:a,resetProfile:U}}const ge={class:"space-y-6"},Ve={key:0,class:"flex justify-center items-center py-8"},we={class:"flex items-center justify-between"},he={class:"flex items-center gap-2"},xe={key:1,class:"flex gap-2"},ke={class:"flex flex-col sm:flex-row gap-6 items-start sm:items-center pb-6 mb-6 border-b"},$e={class:"space-y-2"},De={class:"text-xl font-semibold"},Se={class:"text-muted-foreground"},Ue={class:"text-sm text-muted-foreground"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Pe={class:"space-y-2"},Ee={class:"space-y-2"},Te={class:"space-y-2"},Ce={class:"space-y-2"},Me={class:"space-y-2"},Fe={class:"flex"},Ie={class:"space-y-2"},Be={class:"space-y-2"},je={class:"md:col-span-2 space-y-2"},Ae={class:"space-y-2"},Oe={class:"space-y-2"},He={class:"space-y-2"},Le={class:"space-y-2"},We={class:"flex"},Ke=ee({__name:"index",setup(A){const{profile:l,isLoading:k,fetchProfile:S,updateProfile:T}=ye(),_=x(!1),b=x(""),y=x(""),a=L({fullname:"",mykad_number:"",mobile_number:"",gender:void 0,date_of_birth:"",residential_address:"",postcode:"",city:"",state:"",spouse_name:"",spouse_mobile_phone:""}),U=L({email_notifications:!0,sms_notifications:!0}),m=D(()=>{if(!l.value)return!1;const o=O(l.value.user_date_of_birth);return a.fullname!==l.value.user_fullname||a.mykad_number!==(l.value.user_mykad_number||"")||c(b.value)!==(l.value.user_mobile_number||"")||a.gender!==l.value.user_gender||a.date_of_birth!==o||a.residential_address!==(l.value.user_residential_address||"")||a.postcode!==(l.value.user_postcode||"")||a.city!==(l.value.user_city||"")||a.state!==(l.value.user_state||"")||a.spouse_name!==(l.value.user_spouse_name||"")||c(y.value)!==(l.value.user_spouse_mobile_phone||"")}),i=x([]),g=o=>o?o.startsWith("+60")?o.slice(3):o:"",c=o=>o?o.startsWith("+60")?o:`+60${o}`:"",C=()=>{a.mobile_number=c(b.value)},M=()=>{a.spouse_mobile_phone=c(y.value)},Z=o=>o.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2),O=o=>{if(!o)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(o))return o;if(o.includes("T")&&o.includes("Z")){if(o.match(/T\d{2}:00:00\.000Z$/)){const e=new Date(o);return e.getUTCHours()>0&&e.setUTCDate(e.getUTCDate()+1),e.toISOString().split("T")[0]}return o.split("T")[0]}try{const e=new Date(o),u=e.getFullYear(),Y=String(e.getMonth()+1).padStart(2,"0"),X=String(e.getDate()).padStart(2,"0");return`${u}-${Y}-${X}`}catch{return""}},q=o=>o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Date not available",F=()=>{l.value&&(a.fullname=l.value.user_fullname||"",a.mykad_number=l.value.user_mykad_number||"",a.mobile_number=l.value.user_mobile_number||"",a.gender=l.value.user_gender,a.date_of_birth=O(l.value.user_date_of_birth),a.residential_address=l.value.user_residential_address||"",a.postcode=l.value.user_postcode||"",a.city=l.value.user_city||"",a.state=l.value.user_state||"",a.spouse_name=l.value.user_spouse_name||"",a.spouse_mobile_phone=l.value.user_spouse_mobile_phone||"",b.value=g(l.value.user_mobile_number||""),y.value=g(l.value.user_spouse_mobile_phone||""),U.email_notifications=l.value.email_notifications??!0,U.sms_notifications=l.value.sms_notifications??!0)},J=()=>{_.value=!0,F()},K=()=>{_.value=!1,F()},Q=async()=>{const o=await E().get("/states");i.value=o.data.states},H=async()=>{if(!m.value){_.value=!1;return}try{a.mobile_number=c(b.value),a.spouse_mobile_phone=c(y.value);const o=await T(a);await S()}catch(o){console.error("Error saving profile:",o)}};return se(async()=>{await S(),await Q(),F()}),(o,e)=>(h(),N("div",ge,[s(k)?(h(),N("div",Ve,e[12]||(e[12]=[n("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)]))):s(l)?(h(),I(s(be),{key:1},{default:r(()=>[t(s(me),null,{default:r(()=>[n("div",we,[n("div",null,[t(s(de),null,{default:r(()=>e[13]||(e[13]=[d("Personal Information")])),_:1,__:[13]}),t(s(ie),null,{default:r(()=>e[14]||(e[14]=[d("Update your personal information")])),_:1,__:[14]})]),n("div",he,[_.value?(h(),N("div",xe,[t(s(B),{variant:"outline",onClick:K},{default:r(()=>e[16]||(e[16]=[d(" Cancel ")])),_:1,__:[16]}),t(s(B),{onClick:H,disabled:s(k),class:"flex items-center gap-2"},{default:r(()=>[t(s(le),{class:"h-4 w-4"}),d(" "+w(s(k)?"Saving...":"Save"),1)]),_:1},8,["disabled"])])):(h(),I(s(B),{key:0,onClick:J,class:"flex items-center gap-2"},{default:r(()=>[t(s(te),{class:"h-4 w-4"}),e[15]||(e[15]=d(" Edit Profile "))]),_:1,__:[15]}))])])]),_:1}),t(s(ve),{class:"p-6"},{default:r(()=>[n("div",ke,[t(s(_e),{class:"h-24 w-24"},{default:r(()=>[t(s(fe),{src:s(l).avatar||"/avatars/user-placeholder.jpg",alt:"User"},null,8,["src"]),t(s(ce),{class:"text-lg"},{default:r(()=>[d(w(Z(s(l).user_fullname)),1)]),_:1})]),_:1}),n("div",$e,[n("h3",De,w(s(l).user_fullname),1),n("p",Se,w(s(l).user_email)+" | "+w(s(l).user_mykad_number),1),n("p",Ue," Registered on "+w(q(s(l).user_created_at)),1)])]),n("form",{onSubmit:ue(H,["prevent"])},[n("div",Ne,[n("div",Pe,[t(s(f),{for:"fullName"},{default:r(()=>e[17]||(e[17]=[d("Full Name")])),_:1,__:[17]}),t(s(v),{id:"fullName",modelValue:a.fullname,"onUpdate:modelValue":e[0]||(e[0]=u=>a.fullname=u),disabled:"",required:""},null,8,["modelValue"])]),n("div",Ee,[t(s(f),{for:"ic"},{default:r(()=>e[18]||(e[18]=[d("MyKad Number")])),_:1,__:[18]}),t(s(v),{id:"ic",modelValue:a.mykad_number,"onUpdate:modelValue":e[1]||(e[1]=u=>a.mykad_number=u),disabled:"",placeholder:"123456-78-9012"},null,8,["modelValue"])]),n("div",Te,[t(s(f),{for:"email"},{default:r(()=>e[19]||(e[19]=[d("Email")])),_:1,__:[19]}),t(s(v),{id:"email",modelValue:s(l).user_email,"onUpdate:modelValue":e[2]||(e[2]=u=>s(l).user_email=u),disabled:"",type:"email"},null,8,["modelValue"])]),n("div",Ce,[t(s(f),{for:"state"},{default:r(()=>e[20]||(e[20]=[d("State")])),_:1,__:[20]}),t(s(W),{modelValue:a.state,"onUpdate:modelValue":e[3]||(e[3]=u=>a.state=u),disabled:""},{default:r(()=>[t(s(z),{id:"state",class:"w-full"},{default:r(()=>[t(s(G),{placeholder:"Select state"})]),_:1}),t(s(R),null,{default:r(()=>[(h(!0),N(oe,null,re(i.value,u=>(h(),I(s(j),{key:u.code,value:u.code},{default:r(()=>[d(w(u.title),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),n("div",Me,[t(s(f),{for:"phone"},{default:r(()=>e[21]||(e[21]=[d("Mobile Number")])),_:1,__:[21]}),n("div",Fe,[e[22]||(e[22]=n("div",{class:"flex items-center px-3 border border-r-0 rounded-l-md bg-muted text-muted-foreground text-sm"}," +60 ",-1)),t(s(v),{id:"phone",modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=u=>b.value=u),disabled:!_.value,placeholder:"123456789",class:"rounded-l-none",onInput:C},null,8,["modelValue","disabled"])])]),n("div",Ie,[t(s(f),{for:"gender"},{default:r(()=>e[23]||(e[23]=[d("Gender")])),_:1,__:[23]}),t(s(W),{modelValue:a.gender,"onUpdate:modelValue":e[5]||(e[5]=u=>a.gender=u),disabled:!_.value},{default:r(()=>[t(s(z),{id:"gender",class:"w-full"},{default:r(()=>[t(s(G),{placeholder:"Select gender"})]),_:1}),t(s(R),null,{default:r(()=>[t(s(j),{value:"male"},{default:r(()=>e[24]||(e[24]=[d("Male")])),_:1,__:[24]}),t(s(j),{value:"female"},{default:r(()=>e[25]||(e[25]=[d("Female")])),_:1,__:[25]})]),_:1})]),_:1},8,["modelValue","disabled"])]),n("div",Be,[t(s(f),{for:"dateOfBirth"},{default:r(()=>e[26]||(e[26]=[d("Date of Birth")])),_:1,__:[26]}),t(s(v),{id:"dateOfBirth",modelValue:a.date_of_birth,"onUpdate:modelValue":e[6]||(e[6]=u=>a.date_of_birth=u),disabled:!_.value,type:"date"},null,8,["modelValue","disabled"])]),n("div",je,[t(s(f),{for:"address"},{default:r(()=>e[27]||(e[27]=[d("Address")])),_:1,__:[27]}),t(s(pe),{id:"address",modelValue:a.residential_address,"onUpdate:modelValue":e[7]||(e[7]=u=>a.residential_address=u),disabled:!_.value,rows:"3",placeholder:"Enter full address"},null,8,["modelValue","disabled"])]),n("div",Ae,[t(s(f),{for:"postcode"},{default:r(()=>e[28]||(e[28]=[d("Postcode")])),_:1,__:[28]}),t(s(v),{id:"postcode",modelValue:a.postcode,"onUpdate:modelValue":e[8]||(e[8]=u=>a.postcode=u),disabled:!_.value,placeholder:"12345"},null,8,["modelValue","disabled"])]),n("div",Oe,[t(s(f),{for:"city"},{default:r(()=>e[29]||(e[29]=[d("City")])),_:1,__:[29]}),t(s(v),{id:"city",modelValue:a.city,"onUpdate:modelValue":e[9]||(e[9]=u=>a.city=u),disabled:!_.value,placeholder:"City name"},null,8,["modelValue","disabled"])]),n("div",He,[t(s(f),{for:"spouseName"},{default:r(()=>e[30]||(e[30]=[d("Spouse Name")])),_:1,__:[30]}),t(s(v),{id:"spouseName",modelValue:a.spouse_name,"onUpdate:modelValue":e[10]||(e[10]=u=>a.spouse_name=u),disabled:!_.value,placeholder:"Spouse name (optional)"},null,8,["modelValue","disabled"])]),n("div",Le,[t(s(f),{for:"spousePhone"},{default:r(()=>e[31]||(e[31]=[d("Spouse Phone")])),_:1,__:[31]}),n("div",We,[e[32]||(e[32]=n("div",{class:"flex items-center px-3 border border-r-0 rounded-l-md bg-muted text-muted-foreground text-sm"}," +60 ",-1)),t(s(v),{id:"spousePhone",modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=u=>y.value=u),disabled:!_.value,placeholder:"123456789 (optional)",class:"rounded-l-none",onInput:M},null,8,["modelValue","disabled"])])])])],32)]),_:1})]),_:1})):ae("",!0)]))}});export{Ke as default};
